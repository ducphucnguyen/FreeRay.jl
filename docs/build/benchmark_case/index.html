<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Benchmark cases · FreeRay</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">FreeRay</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">FreeRay : Bellhop for Outdoor Sound Propagation</a></li><li class="is-active"><a class="tocitem" href>Benchmark cases</a><ul class="internal"><li><a class="tocitem" href="#Case-1:-Constant-sound-speed-profile"><span>Case 1: Constant sound speed profile</span></a></li><li><a class="tocitem" href="#Case-2:-Positive-sound-gradient-(Downwind)"><span>Case 2: Positive sound gradient (Downwind)</span></a></li><li><a class="tocitem" href="#Case-3:-Negative-sound-gradient-(Upwind)"><span>Case 3: Negative sound gradient (Upwind)</span></a></li><li><a class="tocitem" href="#Case-4:-Composite-profile"><span>Case 4: Composite profile</span></a></li></ul></li><li><a class="tocitem" href="../real_example/">Wind turbine noise propagation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Benchmark cases</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Benchmark cases</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com//blob/master/docs/src/benchmark_case.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Benchmark-cases"><a class="docs-heading-anchor" href="#Benchmark-cases">Benchmark cases</a><a id="Benchmark-cases-1"></a><a class="docs-heading-anchor-permalink" href="#Benchmark-cases" title="Permalink"></a></h1><p>In this example, we will use FreeRay to model 4 benchmark cases for outdoor sound propagation as published by <a href="https://asa.scitation.org/doi/abs/10.1121/1.412302">Attenborough et al. (1995)</a>.</p><p>There is an unit point source at <span>$h_s = 5.0$</span> m, a receiver at <span>$h_r = 1.0$</span> m and at a horizontal range <span>$R=10,000$</span> m. The source emits a constant tone of <span>$f = 100$</span> Hz.</p><p>The ground surface is treated as an impedance boundary with the specific characteristic impedance <span>$Z_c = 12.81 + i11.62$</span>. This value is used to calculate spherical-wave reflection coefficients.</p><p>The differences between 4 benchmark cases are the use of different sound speed profiles such as constant, positive, negative and composite profiles.</p><h2 id="Case-1:-Constant-sound-speed-profile"><a class="docs-heading-anchor" href="#Case-1:-Constant-sound-speed-profile">Case 1: Constant sound speed profile</a><a id="Case-1:-Constant-sound-speed-profile-1"></a><a class="docs-heading-anchor-permalink" href="#Case-1:-Constant-sound-speed-profile" title="Permalink"></a></h2><p align="center">
    <img width=350 height=200 src="./case1.png">
</p><p>Load FreeRay package</p><pre><code class="language-julia">using FreeRay</code></pre><h3 id="Source"><a class="docs-heading-anchor" href="#Source">Source</a><a id="Source-1"></a><a class="docs-heading-anchor-permalink" href="#Source" title="Permalink"></a></h3><p>We may notice that the source height is inputted as a negative number. This is convention of Bellhop where upper and lower spaces are modelled as negative and positive axis, respectively. We are interested in upper space, so hereafter all input values for height are negative numbers.</p><pre><code class="language-julia">source = Source(
        frequency = 100f0, # Hz, f0 indicate Float32 number.
        height = -5f0) # m, height</code></pre><h3 id="Receiver"><a class="docs-heading-anchor" href="#Receiver">Receiver</a><a id="Receiver-1"></a><a class="docs-heading-anchor-permalink" href="#Receiver" title="Permalink"></a></h3><p>In the benchmark case, only receiver at 1.0 m is interested, but to plot the transmission loss field, we here will calculate for every grid points spacing 1.0 m in both vertical and horizontal directions. The investigation region is 1,000 m in height and 10,000 m in range. Obviously, this will cover the configuration of the benchmark case!</p><pre><code class="language-julia">receiver = Receiver(
        depth_point = 1001, # number of points in height
        range_point = 10001, # number of points in range
        depth = Vec2(-1000f0,0f0), # height between -1000 m and 0
        range = Vec2(0f0,10f0)) # range between 0 and 10 km (range is always in km)</code></pre><h3 id="Terrain-geometry"><a class="docs-heading-anchor" href="#Terrain-geometry">Terrain geometry</a><a id="Terrain-geometry-1"></a><a class="docs-heading-anchor-permalink" href="#Terrain-geometry" title="Permalink"></a></h3><p>We assume that the ground elevation is flat for now, real ground elevation will be discussed in other examples.</p><pre><code class="language-julia">terrain = Terrain(
    interp_type = &quot;C&quot;, # interpolation method for ground elevation
    profile = (Vec2([0f0,5f0,10f0],[0f0,0f0,0f0])) # need 3 points for modelling flat terrain
)</code></pre><h3 id="Boundary-condition"><a class="docs-heading-anchor" href="#Boundary-condition">Boundary condition</a><a id="Boundary-condition-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-condition" title="Permalink"></a></h3><p>The ground surface is modelled using reflection coefficients which are calculated from characteristic ground impedance <span>$Z_c$</span>. These coefficients are calculated using <code>Q_reflection</code> or <code>R_reflection</code> functions for spherical-wave reflection coefficients or plane-wave reflection coefficients. The top boundary is atmospheric, thus can be modelled as &quot;no reflection&quot;. In other words, the reflection coefficients are zero.</p><pre><code class="language-julia">
# Vec3(grazing angle, coefficient, phase angle)
Zc = 12.81 + 11.62im
Theta, Rmag, Rphase = R_coeff(Zc;len=100) # plane-wave reflection coeff.

brc = Vec3(Theta,Rmag,Rphase)
trc = Vec3([0f0,45f0,90f0],[0f0,0f0,0f0],[0f0,0f0,0f0])

reflection = Reflection_Coeff(
        top_coeff = trc,
        bottom_coeff = brc)</code></pre><h3 id="Sound-speed-profile"><a class="docs-heading-anchor" href="#Sound-speed-profile">Sound speed profile</a><a id="Sound-speed-profile-1"></a><a class="docs-heading-anchor-permalink" href="#Sound-speed-profile" title="Permalink"></a></h3><p>In this case, we use constant sound speed profile <span>$c_0 = 343$</span> m/s.</p><pre><code class="language-julia"># Vec2 (height, sound speed)
sspl = Vec2([-1000f0,-500f0,0f0],[343f0,343f0,343f0])
ssp = SSP(sound_speed_profile = sspl)</code></pre><h3 id="Analysis"><a class="docs-heading-anchor" href="#Analysis">Analysis</a><a id="Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis" title="Permalink"></a></h3><p>This is an important part to specify what analysis we want to run. There are several options as follows:</p><ul><li><code>analyse = &quot;R&quot;</code>       - ray tracing</li><li><code>analyse = &quot;E&quot;</code>       - eigenray</li><li><code>analyse = &quot;A&quot;</code>       - amplitudes and travel times</li></ul><ul><li><code>analyse = &quot;CG&quot;</code>      - coherent geometric ray model</li><li><code>analyse = &quot;IG&quot;</code>      - incoherent geometric ray model</li><li><code>analyse = &quot;CB&quot;</code>      - coherent Gaussian ray model</li><li><code>analyse = &quot;IB&quot;</code>      - incoherent Gaussian ray model</li></ul><p>Other options can be found in Bellhop document.</p><pre><code class="language-julia">opt = Analysis(
    filename = &quot;Case0_Bellhop_f10&quot;, # name of output files
    analyse = &quot;RG&quot;, # analysis options C-coherent, I-incoherent, G-Geometric ray, B- Gaussian ray.
    option1 = &quot;CFW&quot;,
    option2 = &quot;F*&quot;,
    num_ray = 161, # number of ray, resulting in resolution of take-off angles
    alpha = Vec2(-80.0f0,80.0f0), # take-off angle from -80 to 80
    box = Vec2(10f0,1000.0f0), # analysis region
    step= 0
)</code></pre><h3 id="Create-input-files"><a class="docs-heading-anchor" href="#Create-input-files">Create input files</a><a id="Create-input-files-1"></a><a class="docs-heading-anchor-permalink" href="#Create-input-files" title="Permalink"></a></h3><p>All input files will be created for analysis.</p><pre><code class="language-julia">Environment(opt,source, receiver,ssp,terrain,reflection)</code></pre><h3 id="Run-Bellhop"><a class="docs-heading-anchor" href="#Run-Bellhop">Run Bellhop</a><a id="Run-Bellhop-1"></a><a class="docs-heading-anchor-permalink" href="#Run-Bellhop" title="Permalink"></a></h3><p>To run Bellhop in Julia, we just need to call <code>run(bellhop filename)</code>. To see running time, we use macro <code>@time</code>.</p><pre><code class="language-julia">fn = opt.filename
filename = &quot;temp\\$fn&quot;
run_bellhop = `bellhop $filename`
@time run(run_bellhop)</code></pre><h3 id="Plots"><a class="docs-heading-anchor" href="#Plots">Plots</a><a id="Plots-1"></a><a class="docs-heading-anchor-permalink" href="#Plots" title="Permalink"></a></h3><p>It takes 0.21 seconds to run ray tracing.</p><pre><code class="language-julia"># plot ray
PlotRay(&quot;$filename.ray&quot;,
        xlabs = &quot;Range, m&quot;,
        ylabs = &quot;Height, m&quot;)</code></pre><p align="center">
    <img width=350 height=200 src="./ray1.png">
</p><p>It takes 7.18 seconds to analyse transmission loss field. The results seem to be not really good at near top layer and distances faraway from the source. We may need to increase the resolution of take-off angles of rays. Currently we use 161 rays, resulting in the resolution is 1 deg.</p><pre><code class="language-julia"># plot transmission loss field
PlotShd(&quot;$filename.shd&quot;;
        xlabs = &quot;Range, m&quot;,
        ylabs = &quot;Transmission loss, dB&quot;,
        cblabs = &quot;dB&quot;,
        climb = (40,80))</code></pre><p align="center">
    <img width=350 height=200 src="./transc1.png">
</p><p>Now we try 1601 rays with the resolution of 0.1 deg. It&#39;s much better! and it takes only 12.7 seconds to analyse the acoustic field with 1.0 x 10 km with 1.0 m grid and 0.1 deg take-off angle resolution. It is really fast! This is expected because Bellhop is a highly efficient and optimal program written in Fortran. Thus, it is no need to be rewritten in other languages! (I did try in Julia but my code is not better than Bellhop :))</p><p>My question is if we can make it faster? We will save the answer to a real problem at next section.</p><p align="center">
    <img width=350 height=200 src="./trans2.png">
</p><h2 id="Case-2:-Positive-sound-gradient-(Downwind)"><a class="docs-heading-anchor" href="#Case-2:-Positive-sound-gradient-(Downwind)">Case 2: Positive sound gradient (Downwind)</a><a id="Case-2:-Positive-sound-gradient-(Downwind)-1"></a><a class="docs-heading-anchor-permalink" href="#Case-2:-Positive-sound-gradient-(Downwind)" title="Permalink"></a></h2><p align="center">
    <img width=350 height=200 src="./case2.png">
</p><p>In this case, we only need to modify sound gradient in below code</p><pre><code class="language-julia"># Vec2 (height, sound speed)
sspl = Vec2([-1000f0,-500f0,0f0],[443f0,393f0,343f0])
ssp = SSP(sound_speed_profile = sspl)</code></pre><p>It takes 0.31 seconds to run ray tracing and 23.7 seconds to run transmission loss field.</p><p align="center">
    <img width=350 height=200 src="./ray2.png">
</p><p align="center">
    <img width=350 height=200 src="./transc2.png">
</p><h2 id="Case-3:-Negative-sound-gradient-(Upwind)"><a class="docs-heading-anchor" href="#Case-3:-Negative-sound-gradient-(Upwind)">Case 3: Negative sound gradient (Upwind)</a><a id="Case-3:-Negative-sound-gradient-(Upwind)-1"></a><a class="docs-heading-anchor-permalink" href="#Case-3:-Negative-sound-gradient-(Upwind)" title="Permalink"></a></h2><p align="center">
    <img width=350 height=200 src="./case3.png">
</p><p>Modify to negative sound gradient</p><pre><code class="language-julia"># Vec2 (height, sound speed)
sspl = Vec2([-1000f0,-500f0,0f0],[243f0,293f0,343f0])
ssp = SSP(sound_speed_profile = sspl)</code></pre><p align="center">
    <img width=350 height=200 src="./ray3.png">
</p><p align="center">
    <img width=350 height=200 src="./transc3.png">
</p><h2 id="Case-4:-Composite-profile"><a class="docs-heading-anchor" href="#Case-4:-Composite-profile">Case 4: Composite profile</a><a id="Case-4:-Composite-profile-1"></a><a class="docs-heading-anchor-permalink" href="#Case-4:-Composite-profile" title="Permalink"></a></h2><p align="center">
    <img width=350 height=200 src="./case4.png">
</p><p>Modify to composite sound gradient.</p><pre><code class="language-julia"># Vec2 (height, sound speed)
sspl = Vec2([-1000f0,-300f0,-100f0,0f0],[333f0,333f0,353f0,343f0])
ssp = SSP(sound_speed_profile = sspl)</code></pre><p align="center">
    <img width=350 height=200 src="./ray4.png">
</p><p align="center">
    <img width=350 height=200 src="./transc4.png">
</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« FreeRay : Bellhop for Outdoor Sound Propagation</a><a class="docs-footer-nextpage" href="../real_example/">Wind turbine noise propagation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 31 December 2020 15:24">Thursday 31 December 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
